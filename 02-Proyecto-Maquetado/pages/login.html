<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motorgsa - Login</title>
    <link rel="stylesheet" href="../assets/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1><i class="fas fa-tractor"></i> Motorgsa</h1>
            <p>Repuestos y motores agrícolas</p>
        </div>

        <div class="main-content">
            <div class="form-container fade-in">
                <h2 style="text-align: center; margin-bottom: 1rem; color: #2E7D32; font-size: 1.1rem;">
                    <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                </h2>

                <div id="loginForm">
                    <div class="form-group">
                        <label for="username">Usuario o Correo</label>
                        <input type="text" id="username" placeholder="Usuario o correo electrónico" required>
                    </div>

                    <div class="form-group">
                        <label for="password">Contraseña</label>
                        <input type="password" id="password" placeholder="Contraseña" required>
                    </div>

                    <button class="btn" onclick="login()">
                        <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                    </button>

                    <div style="text-align: center; margin-top: 0.5rem;">
                        <p style="color: #888; font-size: 0.8rem;">
                            ¿No tienes cuenta? 
                            <a href="registro.html" style="color: #2E7D32; text-decoration: none;">
                                Regístrate
                            </a>
                        </p>
                    </div>
                    <div class="auth-footer">
                        <p><a href="../index.html">← Volver al inicio</a></p>
                    </div>
                </div>

                <!-- Pantalla de elección de tipo de cuenta -->
                <div id="registerChoiceForm" style="display: none;">
                    <h3 style="text-align: center; margin-bottom: 1.5rem; color: #2E7D32;">
                        <i class="fas fa-user-plus"></i> ¿Qué tipo de cuenta deseas crear?
                    </h3>
                    
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <button class="btn" onclick="window.location.href='registroCliente.html'" style="background-color: #2E7D32; border: 2px solid #2E7D32;">
                            <i class="fas fa-user"></i> Cliente
                            <div style="font-size: 0.8rem; margin-top: 0.25rem; opacity: 0.9;">
                                Cuenta personal para compras
                            </div>
                        </button>
                        
                        <button class="btn" onclick="window.location.href='registroDistribuidor.html'" style="background-color: #333; border: 2px solid #333;">
                            <i class="fas fa-building"></i> Distribuidor
                            <div style="font-size: 0.8rem; margin-top: 0.25rem; opacity: 0.9;">
                                Cuenta empresarial (requiere aprobación)
                            </div>
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: 1rem;">
                        <p style="color: #888; font-size: 0.8rem;">
                            ¿Ya tienes cuenta? 
                            <a href="#" onclick="showLoginForm()" style="color: #2E7D32; text-decoration: none;">
                                Inicia sesión
                            </a>
                        </p>
                    </div>
                </div>

                <div id="messageContainer"></div>

                <!-- Botón para información de la empresa -->
                <div style="text-align: center; margin-top: 1rem;">
                    <button class="btn" style="background-color: #333; margin-bottom: 0.5rem;" onclick="showCompanyInfo()">
                        <i class="fas fa-info-circle"></i> Conoce Nuestra Empresa
                    </button>
                </div>

                <!-- Usuarios de prueba compactos -->
                <div style="margin-top: 1rem; padding: 0.5rem; background-color: #2a2a2a; border-radius: 8px; border-left: 3px solid #2E7D32; font-size: 0.8rem;">
                    <h4 style="color: #2E7D32; margin-bottom: 0.5rem; font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> Usuarios de Prueba
                    </h4>
                    <p><strong>Cliente:</strong> cliente1 / 123456</p>
                    <p><strong>Distribuidor:</strong> distribuidor1 / 123456</p>
                    <p><strong>Admin:</strong> admin / admin123</p>
                </div>
            </div>
        </div>
    </div>

    <script src="../data/users.js"></script>
    <script>
        function showLoginForm() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerChoiceForm').style.display = 'none';
        }

        function showRegisterForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerChoiceForm').style.display = 'block';
        }

        function showMessage(message, type) {
            const container = document.getElementById('messageContainer');
            container.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => container.innerHTML = '', 3000);
        }

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (!username || !password) {
                showMessage('Completa todos los campos', 'error');
                return;
            }

            const user = authenticateUser(username, password);
            
            if (user) {
                // Verificar el estado del usuario
                if (user.estado === 'pendiente') {
                    showMessage('Tu cuenta está pendiente de aprobación por el Administrador', 'error');
                    return;
                } else if (user.estado === 'rechazado') {
                    showMessage('Tu cuenta fue rechazada por el Administrador', 'error');
                    return;
                }
                
                localStorage.setItem('currentUser', JSON.stringify(user));
                localStorage.setItem('isLoggedIn', 'true');
                
                showMessage(`¡Bienvenido ${user.name}!`, 'success');
                
                setTimeout(() => {
                    if (user.role === 'admin') {
                        window.location.href = 'admin.html';
                    } else {
                        window.location.href = 'home.html';
                    }
                }, 1000);
            } else {
                showMessage('Usuario o contraseña incorrectos', 'error');
            }
        }

        // Función para manejar el enlace de "Volver a elegir tipo de cuenta"
        function showRegisterChoice() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerChoiceForm').style.display = 'block';
        }

        function navigateTo(page) {
            if (page === 'home') {
                window.location.href = 'home.html';
            } else if (page === 'cart') {
                window.location.href = 'cart.html';
            } else if (page === 'profile') {
                window.location.href = 'profile.html';
            }
        }

        function showCompanyInfo() {
            window.location.href = 'about.html';
        }

        window.onload = function() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            if (isLoggedIn === 'true') {
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (currentUser) {
                    if (currentUser.role === 'admin') {
                        window.location.href = 'admin.html';
                    } else {
                        window.location.href = 'home.html';
                    }
                }
            }
        };
    </script>
</body>
</html>
