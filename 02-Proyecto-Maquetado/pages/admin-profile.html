<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motorgsa - Perfil Administrador</title>
    <link rel="stylesheet" href="../assets/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .admin-header {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 420px;
            background: linear-gradient(135deg, #2E7D32, #1B5E20);
            padding: 0.5rem;
            text-align: center;
            z-index: 1000;
            border-radius: 0 0 10px 10px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="admin-header">
            <h1 class="panel-title" style="font-size: 1.2rem; margin: 0;"><i class="fas fa-tractor"></i> Motorgsa - Perfil Administrador</h1>
        </div>

        <div class="admin-main-content">
            <!-- Información Personal -->
            <div class="admin-profile-section">
                <h3><i class="fas fa-user"></i> Información Personal</h3>
                
                <div class="admin-profile-image-container">
                    <img id="adminProfileImage" src="https://via.placeholder.com/120x120/2a2a2a/E50914?text=Admin" 
                         alt="Foto de perfil" class="admin-profile-image">
                </div>
                
                <div class="admin-profile-info">
                    <div class="admin-profile-name" id="adminName">Administrador</div>
                    <div class="admin-profile-role">Administrador</div>
                    <div class="admin-profile-email" id="adminEmail">admin@motorgsa.com</div>
                    <div class="admin-profile-phone" id="adminPhone">555-0001</div>
                </div>

                <div class="admin-profile-actions">
                    <button class="admin-edit-btn" onclick="editAdminProfile()">
                        <i class="fas fa-edit"></i> Editar Perfil
                    </button>
                    <button class="admin-edit-btn" onclick="changeProfileImage()">
                        <i class="fas fa-camera"></i> Cambiar Foto
                    </button>
                </div>
            </div>

            <!-- Actividad Reciente -->
            <div class="admin-profile-section">
                <h3><i class="fas fa-history"></i> Actividad Reciente</h3>
                <div class="admin-log-list">
                    <div class="admin-log-item">
                        <div class="admin-log-action">Producto agregado</div>
                        <div>Filtro de Aceite Premium - $25.99</div>
                        <div class="admin-log-date">Hoy, 14:30</div>
                    </div>
                    <div class="admin-log-item">
                        <div class="admin-log-action">Usuario registrado</div>
                        <div>Nuevo cliente: Juan Pérez</div>
                        <div class="admin-log-date">Ayer, 16:45</div>
                    </div>
                    <div class="admin-log-item">
                        <div class="admin-log-action">Compra procesada</div>
                        <div>Pedido #1234 - $89.99</div>
                        <div class="admin-log-date">Hace 2 días, 10:15</div>
                    </div>
                    <div class="admin-log-item">
                        <div class="admin-log-action">Producto eliminado</div>
                        <div>Batería de Auto - $89.99</div>
                        <div class="admin-log-date">Hace 3 días, 09:20</div>
                    </div>
                </div>
            </div>

            <!-- Estadísticas -->
            <div class="admin-profile-section">
                <h3><i class="fas fa-chart-bar"></i> Estadísticas</h3>
                <div class="admin-stats-grid">
                    <div class="admin-stat-item">
                        <div class="admin-stat-value">5</div>
                        <div class="admin-stat-label">Usuarios</div>
                    </div>
                    <div class="admin-stat-item">
                        <div class="admin-stat-value">8</div>
                        <div class="admin-stat-label">Productos</div>
                    </div>
                    <div class="admin-stat-item">
                        <div class="admin-stat-value">12</div>
                        <div class="admin-stat-label">Compras</div>
                    </div>
                    <div class="admin-stat-item">
                        <div class="admin-stat-value">$1,234</div>
                        <div class="admin-stat-label">Ingresos</div>
                    </div>
                </div>
            </div>

            <!-- Botón de Cerrar Sesión -->
            <div class="admin-profile-section">
                <button class="btn" onclick="logout()" style="background-color: #dc3545;">
                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                </button>
            </div>
        </div>

        <!-- Barra de navegación inferior para Admin -->
        <div class="admin-bottom-nav">
            <button class="admin-nav-item" onclick="window.location.href='admin.html'">
                <i class="fas fa-users"></i>
                <span>Clientes</span>
            </button>
            <button class="admin-nav-item" onclick="window.location.href='admin.html'">
                <i class="fas fa-shopping-bag"></i>
                <span>Pagos</span>
            </button>
            <button class="admin-nav-item" onclick="window.location.href='admin.html'">
                <i class="fas fa-box"></i>
                <span>Productos</span>
            </button>
            <button class="admin-nav-item" onclick="window.location.href='admin.html'">
                <i class="fas fa-plus"></i>
                <span>Agregar</span>
            </button>
            <button class="admin-profile-btn active" onclick="window.location.href='admin-profile.html'" title="Perfil de Administrador">
                <i class="fas fa-user-cog"></i>
            </button>
        </div>
    </div>

    <script src="../data/users.js"></script>
    <script src="../data/products.js"></script>
    <script>
        let currentUser = null;

        window.onload = function() {
            checkAuth();
            loadAdminProfileData();
        };

        function checkAuth() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            if (isLoggedIn !== 'true') {
                window.location.href = 'login.html';
                return;
            }

            currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser || currentUser.role !== 'admin') {
                window.location.href = 'login.html';
                return;
            }
        }

        function loadAdminProfileData() {
            // Cargar información del administrador
            document.getElementById('adminName').textContent = currentUser.name;
            document.getElementById('adminEmail').textContent = currentUser.email;
            document.getElementById('adminPhone').textContent = currentUser.phone || 'No especificado';

            // Cargar imagen de perfil si existe
            const profileImage = localStorage.getItem('adminProfileImage');
            if (profileImage) {
                document.getElementById('adminProfileImage').src = profileImage;
            }
        }

        function editAdminProfile() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 2000;
                padding: 1rem;
            `;

            modal.innerHTML = `
                <div style="
                    background-color: #1a1a1a;
                    border-radius: 15px;
                    padding: 1.5rem;
                    max-width: 350px;
                    width: 100%;
                    border: 2px solid #2E7D32;
                    position: relative;
                ">
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        position: absolute;
                        top: 10px;
                        right: 15px;
                        background: none;
                        border: none;
                        color: #ffffff;
                        font-size: 1.2rem;
                        cursor: pointer;
                    ">×</button>
                    
                    <h3 style="color: #2E7D32; margin-bottom: 1rem; text-align: center;">
                        <i class="fas fa-edit"></i> Editar Perfil
                    </h3>
                    
                    <div class="form-group">
                        <label for="editAdminName">Nombre</label>
                        <input type="text" id="editAdminName" value="${currentUser.name}" placeholder="Nombre completo">
                    </div>

                    <div class="form-group">
                        <label for="editAdminEmail">Email</label>
                        <input type="email" id="editAdminEmail" value="${currentUser.email}" placeholder="Email">
                    </div>

                    <div class="form-group">
                        <label for="editAdminPhone">Teléfono</label>
                        <input type="tel" id="editAdminPhone" value="${currentUser.phone || ''}" placeholder="Teléfono">
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                        <button onclick="saveAdminProfile(); this.parentElement.parentElement.parentElement.remove();" style="
                            background-color: #28a745;
                            color: white;
                            border: none;
                            padding: 0.8rem 1.5rem;
                            border-radius: 8px;
                            font-weight: bold;
                            cursor: pointer;
                            flex: 1;
                        ">Guardar</button>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                            background-color: #6c757d;
                            color: white;
                            border: none;
                            padding: 0.8rem 1.5rem;
                            border-radius: 8px;
                            font-weight: bold;
                            cursor: pointer;
                            flex: 1;
                        ">Cancelar</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function saveAdminProfile() {
            const name = document.getElementById('editAdminName').value;
            const email = document.getElementById('editAdminEmail').value;
            const phone = document.getElementById('editAdminPhone').value;

            if (!name || !email) {
                showMessage('Completa los campos obligatorios', 'error');
                return;
            }

            // Actualizar datos del usuario
            currentUser.name = name;
            currentUser.email = email;
            currentUser.phone = phone;

            // Guardar en localStorage
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // Actualizar la vista
            loadAdminProfileData();
            
            showMessage('Perfil actualizado correctamente', 'success');
        }

        function changeProfileImage() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 2000;
                padding: 1rem;
            `;

            modal.innerHTML = `
                <div style="
                    background-color: #1a1a1a;
                    border-radius: 15px;
                    padding: 1.5rem;
                    max-width: 350px;
                    width: 100%;
                    border: 2px solid #2E7D32;
                    position: relative;
                ">
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        position: absolute;
                        top: 10px;
                        right: 15px;
                        background: none;
                        border: none;
                        color: #ffffff;
                        font-size: 1.2rem;
                        cursor: pointer;
                    ">×</button>
                    
                    <h3 style="color: #2E7D32; margin-bottom: 1rem; text-align: center;">
                        <i class="fas fa-camera"></i> Cambiar Foto de Perfil
                    </h3>
                    
                    <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                        <button type="button" class="btn-secondary" onclick="selectLocalImage()" style="flex: 1; padding: 0.8rem;">
                            <i class="fas fa-image"></i> Subir Imagen
                        </button>
                        <button type="button" class="btn-secondary" onclick="selectImageUrl()" style="flex: 1; padding: 0.8rem;">
                            <i class="fas fa-link"></i> Usar URL
                        </button>
                    </div>
                    
                    <!-- Input para imagen local -->
                    <div id="profileImageFileInput" style="display: none;">
                        <input type="file" id="profileImageFile" accept="image/*" onchange="handleProfileImageFileSelect(event)">
                        <p style="font-size: 0.7rem; color: #888; margin-top: 0.3rem;">
                            <i class="fas fa-info-circle"></i> Formatos: JPG, PNG, GIF (máx. 5MB)
                        </p>
                    </div>
                    
                    <!-- Input para URL -->
                    <div id="profileImageUrlInput" style="display: none;">
                        <input type="url" id="profileImageUrl" placeholder="URL de la imagen">
                        <p style="font-size: 0.7rem; color: #888; margin-top: 0.3rem;">
                            <i class="fas fa-info-circle"></i> Pega una URL de imagen válida
                        </p>
                    </div>
                    
                    <!-- Vista previa de imagen -->
                    <div id="profileImagePreview" style="display: none; margin-top: 0.5rem; text-align: center;">
                        <img id="profilePreviewImg" src="" alt="Vista previa" style="
                            max-width: 100%;
                            max-height: 150px;
                            border-radius: 8px;
                            border: 2px solid #2E7D32;
                        ">
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                        <button onclick="saveProfileImage(); this.parentElement.parentElement.parentElement.remove();" style="
                            background-color: #28a745;
                            color: white;
                            border: none;
                            padding: 0.8rem 1.5rem;
                            border-radius: 8px;
                            font-weight: bold;
                            cursor: pointer;
                            flex: 1;
                        ">Guardar</button>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                            background-color: #6c757d;
                            color: white;
                            border: none;
                            padding: 0.8rem 1.5rem;
                            border-radius: 8px;
                            font-weight: bold;
                            cursor: pointer;
                            flex: 1;
                        ">Cancelar</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function selectLocalImage() {
            document.getElementById('profileImageFileInput').style.display = 'block';
            document.getElementById('profileImageUrlInput').style.display = 'none';
            document.getElementById('profileImagePreview').style.display = 'none';
            document.getElementById('profileImageUrl').value = '';
        }

        function selectImageUrl() {
            document.getElementById('profileImageFileInput').style.display = 'none';
            document.getElementById('profileImageUrlInput').style.display = 'block';
            document.getElementById('profileImagePreview').style.display = 'none';
            document.getElementById('profileImageFile').value = '';
            
            // Agregar evento para validar URL
            const urlInput = document.getElementById('profileImageUrl');
            urlInput.addEventListener('input', validateProfileImageUrl);
        }

        function validateProfileImageUrl() {
            const urlInput = document.getElementById('profileImageUrl');
            const url = urlInput.value.trim();
            
            if (url) {
                // Crear imagen temporal para validar
                const img = new Image();
                img.onload = function() {
                    document.getElementById('profilePreviewImg').src = url;
                    document.getElementById('profileImagePreview').style.display = 'block';
                };
                img.onerror = function() {
                    showMessage('URL de imagen no válida', 'error');
                    urlInput.value = '';
                    document.getElementById('profileImagePreview').style.display = 'none';
                };
                img.src = url;
            } else {
                document.getElementById('profileImagePreview').style.display = 'none';
            }
        }

        function handleProfileImageFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                // Validar tamaño del archivo (máximo 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showMessage('La imagen es demasiado grande. Máximo 5MB', 'error');
                    event.target.value = '';
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('profilePreviewImg').src = e.target.result;
                    document.getElementById('profileImagePreview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        function saveProfileImage() {
            const imageFile = document.getElementById('profileImageFile').files[0];
            const imageUrl = document.getElementById('profileImageUrl').value;
            
            let imageData = null;
            
            if (imageFile) {
                imageData = document.getElementById('profilePreviewImg').src;
            } else if (imageUrl) {
                imageData = imageUrl;
            }
            
            if (imageData) {
                document.getElementById('adminProfileImage').src = imageData;
                localStorage.setItem('adminProfileImage', imageData);
                showMessage('Foto de perfil actualizada', 'success');
            } else {
                showMessage('Selecciona una imagen o URL válida', 'error');
            }
        }

        function logout() {
            if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('currentUser');
                localStorage.removeItem('cart');
                window.location.href = 'login.html';
            }
        }

        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.style.position = 'fixed';
            messageDiv.style.top = '10px';
            messageDiv.style.left = '50%';
            messageDiv.style.transform = 'translateX(-50%)';
            messageDiv.style.zIndex = '1000';
            messageDiv.textContent = message;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                document.body.removeChild(messageDiv);
            }, 2000);
        }
    </script>
</body>
</html>
